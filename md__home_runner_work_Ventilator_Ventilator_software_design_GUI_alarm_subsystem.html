<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RespiraWorks Ventilator: Alarm subsystem</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RespiraWorks Ventilator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Alarm subsystem </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a proposed technical design for the alarm subsystem of the ventilator GUI, in response to <a href="https://github.com/RespiraWorks/Ventilator/issues/306">Issue #306</a>.</p>
<p>Almost all alarms will be computed and displayed in the GUI. An exception is the "GUI unresponsive" buzzer alarm implemented on the controller. The current document focuses solely on the GUI-computed alarms.</p>
<p>Specifically, the following is in scope for this document:</p><ul>
<li>Terminology common across the alarm subsystem</li>
<li>The internal representation of alarm subsystem state in C++</li>
<li>Principles of how it can be wired up with GUI elements for reading (rendering) and writing (changing parameters, deactivating alarms)</li>
</ul>
<p>The following is out of scope:</p><ul>
<li>The full set of alarms and precise triggering conditions</li>
<li>The look-and-feel of alarm management in the GUI</li>
</ul>
<h1><a class="anchor" id="autotoc_md367"></a>
Concepts</h1>
<p>ISO-60601-8 (<a href="https://drive.google.com/file/d/1wr9WwpoUfvIk1hiBeBqECrA6jUgHHmgL/view?usp=sharing">here</a>) defines some very useful terminology and principles for alarm management, which we will use and slightly extend. Terms below are in more informal language than in the standard.</p>
<p><b>Alarm</b> - an entity representing the management of detecting a hazardous condition and presenting it to the operator. Groups together the Condition, Occurrence(s) and Signals.</p>
<p><b>Alarm condition</b> - the predicate determining whether a hazardous condition currently exists, e.g. "average PIP over
last 3 breaths is too high". This predicate is a pure boolean function of alarm parameters and system state history, and is not affected by alarm suppressions.</p>
<p><b>Alarm occurrence</b> - a continuous time interval in which an alarm condition is met - from the moment the condition transitioned 0-&gt;1, to the moment it transitions back to 0. An alarm can have at most 1 occurrence at the same time.</p>
<p><b>Alarm signal</b> - something the UI presents to the user that lets them know about an alarm occurrence: e.g. changing the visuals of some UI elements, or buzzing. In the end, the UI presents all alarms via a bunch of signals.</p>
<p><b>Signal types</b>: there are <b>Audio</b> and <b>Visual</b> signals. They are treated differently in several ways. A given alarm occurrence can generate several different types of visual signals at the same time.</p>
<p><b>Presentation of signals:</b> The GUI presents the union of active signals from each alarm with some rules:</p><ul>
<li>There can be only one audio signal played at the same time; highest-priority signal wins.</li>
<li>If several signals should affect the state of a UI element (e.g. background color of a sensor widget), the highest-priority one wins.</li>
</ul>
<p><b>Signals vs Occurrences</b>: Signals are tied to occurrences, with a few gimmicks:</p><ul>
<li>A signal may in some cases be generated after a <b>Signal generation delay</b> from the moment the Occurrence begins.</li>
<li>There are <b>Latching</b> and <b>Non-Latching</b> signals. Latching signals are started by the occurrence and ended manually by a RESET. Non-latching signals automatically stop when the condition stops.</li>
</ul>
<p><b>Suppression</b> - an action by the operator that makes there be fewer signals going on (eg. because they believe an alarm occurrence is a false positive, or if they simply have taken note of it).</p>
<p>There are several types of suppressions:</p><ul>
<li><b>ALARM OFF</b> and <b>ALARM PAUSE</b> - suppresses all signals from an alarm, respectively indefinitely (until the suppression is lifted) and for a specified time. Applies to signals from all occurrences of this alarm.</li>
<li><b>AUDIO OFF</b> and <b>AUDIO PAUSE</b> - suppresses just the audio signals from an alarm. Also applies to all occurrences.</li>
<li><b>GLOBAL AUDIO PAUSE</b> (not in the standard, but in our system requirements) - suppresses audio signals from all alarms for a specified time. Ditto.</li>
<li><b>ACKNOWLEDGE</b> and <b>Timed ACKNOWLEDGE</b> - suppresses the audio signal from the <em>current</em> occurrence of the alarm. In the former case, the suppression ends when the occurrence ends. In the latter case, it ends after a specified time (or when the occurrence ends).</li>
<li><b>RESET</b> - suppresses a Latching signal when its Condition is not met.</li>
</ul>
<h1><a class="anchor" id="autotoc_md368"></a>
Architecture</h1>
<p>The alarm subsystem manages its internal state <b>independently for each alarm</b>, and the state of all alarms is finally <b>joined for presentation</b> at the GUI level _(the presentation of the state of all alarms in the GUI is a complex function because several alarms may affect the same widget or request to play a sound).</p>
<p>The suppression state associated with an alarm is also maintained and presented in the GUI.</p>
<p>For managing the internal state associated with one alarm, data flows from bottom (sensor readings) to top (signals) via several layers, where the function of each layer depends on the parameters configurable in the GUI.</p>
<h2><a class="anchor" id="autotoc_md369"></a>
Maintaining the state of an alarm</h2>
<p>There is a global, fixed, well-known set of alarms.</p>
<p><b>The state of each alarm is maintained as follows:</b></p><ul>
<li>Its priority is known and fixed.</li>
<li>Its condition function is controlled by GUI parameters and can be changed at any time.</li>
<li>Keep track of <em>current occurrence</em> by repeatedly evaluating the condition and watching when it starts and stops being true</li>
<li>For each signal that this alarm may in principle generate:<ul>
<li>Keep track of whether the alarm currently <em>proposes</em> to generate this signal. Usually this is the same as "condition
    is met", but for latching signals it is managed differently.</li>
<li>Keep track of the suppression state of this signal (not suppressed; OFF; PAUSED until a certain time; ACKNOWLEDGEDi ndefinitely or until a certain time). The GUI may modify this.</li>
<li>Be able to tell whether the signal is currently <em>active</em> - i.e. the signal is proposed but not suppressed.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md370"></a>
Binding alarm state to GUI elements</h2>
<p>The rendering and actions of GUI elements are <b>bound to queries and updates</b> over the respective active signals, e.g.:</p><ul>
<li>The "list of all active alarms" widget is bound to the query "collect all alarms that have an active signal"</li>
<li>The background color of the pressure sensor reading widget is bound to the query "red if the PRESSURE TOO HIGH or
  PRESSURE TOO LOW alarm is active, otherwise green"</li>
<li>A component that rings the buzzer is bound to the query "there is an active audio signal from any alarm AND audio
  alarms are not currently globally suppressed"</li>
<li>A widget displaying the Leak alarm has an "Acknowledge" button that is visible only if the respective audio signal is not currently suppressed, and which, if you press it, sets the suppression state of that signal to ACKNOWLEDGED.</li>
</ul>
<h1><a class="anchor" id="autotoc_md371"></a>
C++ representation</h1>
<p>TBD </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
