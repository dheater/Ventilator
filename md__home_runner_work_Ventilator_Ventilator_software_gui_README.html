<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RespiraWorks Ventilator: Ventilator GUI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RespiraWorks Ventilator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ventilator GUI </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="in-action.png" alt="In-Action" class="inline"/></p>
<p>Here resides the code for the ventilator graphical user interface. It is based on QT and runs on Raspberry Pi (henceforth "*RPi*").</p>
<p>Please also see the <a class="el" href="md__home_runner_work_Ventilator_Ventilator_software_design_GUI_architecture.html">Software design pages</a> for more information on GUI architecture.</p>
<h1><a class="anchor" id="autotoc_md449"></a>
Requirements</h1>
<p>For development purposes you may build and run it locally on a Linux or macOS machine of your choice.</p>
<p>To deploy it as intended for the ventilator you will need:</p><ul>
<li>Rasberry Pi 4</li>
<li>SD card</li>
<li>Card reader USB</li>
</ul>
<p>A more complete list of hardware components is on the <a href="../../manufacturing/electrical">Electrical system assembly page</a>.</p>
<h2><a class="anchor" id="autotoc_md450"></a>
SSH access to &lt;em&gt;RPi&lt;/em&gt;</h2>
<p>Username: <code>pi</code> Password: <code>respiraworks</code></p>
<p>To access the <em>RPi</em> remotely, it must be connected to your network. You may connect it physically with an Ethernet cable. If that is not an option, you must provide it with your WiFi credentials.</p>
<p>You may add those credentials to the <em>RPi</em> configuration by directly editing it on the SD card, as described <a href="https://raspberrypi.stackexchange.com/questions/66949/enable-ssh-and-connect-to-a-wifi-network-without-a-keyboard-or-a-screen">here</a>.</p>
<p>Alternatively, if you have a keyboard that you can hook up to the <em>RPi</em>, you may escape the full screen mode and switch to terminal with <code>Ctrl+Alt+F1</code>, and then run <code>sudo raspi-config</code>. You may have to reboot for this toi take effect.</p>
<p>To find out the <em>RPi</em>'s IP address, run <code>ifconfig</code>.</p>
<p>Now you may ssh into the <em>RPi</em> from another machine by running <code>ssh pi@IP_ADDRESS</code></p>
<p>If you have any trouble with serial communications, you may also double on check your <em>RPi</em> configuration with <code>sudo raspi-config</code>.</p>
<h1><a class="anchor" id="autotoc_md451"></a>
Building the GUI</h1>
<p>You may want to build and run the GUI application natively, either on your primary machine or on the <em>RPi</em>. Building natively on <em>RPi</em> assumes a vanilla OS image from the <a href="https://www.raspberrypi.org/">Raspberry Pi website</a> and <b>NOT</b> the RespiraWorks-generated image referred to in the sections above.</p>
<p>The <a href="gui.sh">gui.sh</a> script does almost everything you need:</p><ul>
<li>installs dependencies</li>
<li>builds the app</li>
<li>runs the app</li>
<li>runs unit tests</li>
</ul>
<p>The script should work for most debian systems using <code>apt</code> as the package manager. It should also work on macOS. For a comprehensive list of commands and options you can always run:</p>
<div class="fragment"><div class="line">./gui.sh --help</div>
</div><!-- fragment --><p>Here is a quick summary of some of those options (which may not be up to date).</p>
<p>To install dependencies, run: </p><div class="fragment"><div class="line">./gui.sh --install</div>
</div><!-- fragment --><p>To build the application, run:</p>
<div class="fragment"><div class="line">./gui.sh --build</div>
</div><!-- fragment --><p>You can run this latest step with <code>-j</code> option to make it faster, but when compiling on <em>RPi</em> you may run out of virtual memory.</p>
<p>You can also compile with <code>--debug</code> option. You will see additional information on the screen, and logs will be more detailed (<code>debug</code> and <code>trace</code> level messages will be written), and will output to console in addition to file.</p>
<h2><a class="anchor" id="autotoc_md452"></a>
Mac OS X</h2>
<p>You may also build and run on MacOS, but you may have to install some dependencies manually. This section may be out of date.</p>
<p>Go to <a href="https://www.qt.io/download-open-source">https://www.qt.io/download-open-source</a> and download the Qt Online Installer. When asked to select a version, check "Archive", click "Filter", and select 5.11.3. Unselect all modules except core QT and Charts.</p>
<p>After installation completes, add <code>qmake</code> to your PATH, e.g.:</p>
<p><b>TODO:</b> update these instructions to use 5.11.3</p>
<div class="fragment"><div class="line">export PATH=/Users/$USER/Qt/5.11.3/clang_64/bin:$PATH</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md453"></a>
Installing Qt Creator (optional)</h2>
<p>It is possible to develop the GUI without using Qt Creator, but it is convenient to use Creator for editing the qml layout files.</p>
<p>Note that any resources (e.g. images, all qml files) need to be referenced in the qml.qrc file.</p>
<p>To install Qt Creator on Linux, use: </p><div class="fragment"><div class="line">sudo apt-get install qtcreator</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md454"></a>
Running</h2>
<p>Upon a successful compilation, the executable file is accessible on Linux as:</p>
<div class="fragment"><div class="line">./gui.sh --run --serial-port /dev/ttyS0</div>
</div><!-- fragment --><p>Where you may specify whatever serial port the ventilator controller is for the GUI to communicate with. The above has been the correct port for all prototypes tested to date.</p>
<p>If you do not specify a serial-port, the app will run with pre-recorded data.</p>
<p>If you are running the application remotely, via ssh for example, don't forget to set the display environment variable: </p><div class="fragment"><div class="line">export DISPLAY=:0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md455"></a>
Testing</h2>
<p>To run unit tests, type:</p>
<div class="fragment"><div class="line">./gui.sh --build &amp;&amp; ./gui.sh --test</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md456"></a>
Logs &amp; debugging</h2>
<p>Timestamped logs written by the app should be found locally at:</p>
<div class="fragment"><div class="line">$HOME/.local/share/RespiraWorks/VentilatorUI/gui.log</div>
</div><!-- fragment --><p>Upon start, the application will log the git hash of the commit it was built from.</p>
<p>If app was built in release mode, messages down to <code>info</code> level should be seen. In debug mode, <code>debug</code> as well as <code>trace</code> level messages will also be written to log.</p>
<p>If you want to add additional debug messages, refer to <a href="src/logger.h">logger.h</a>. This is a thread-safe logger. Log macros accept <a href="https://github.com/fmtlib/fmt">fmt</a> syntax.</p>
<h2><a class="anchor" id="autotoc_md457"></a>
Screen resolution issues</h2>
<p>The qml layout has been designed for a resolution of 1024x600, in case of the display defaulting to some other setting, this messes up the GUI layout. If this randomly happens to you (it did to me), add the following to the /boot/config.txt file on your <em>RPi</em>. </p><div class="fragment"><div class="line">hdmi_cvt=1024 600 60 3 0 0 0</div>
<div class="line"> </div>
<div class="line"># uncomment to force a specific HDMI mode (this will force VGA)</div>
<div class="line">hdmi_group=2</div>
<div class="line">hdmi_mode=87</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
