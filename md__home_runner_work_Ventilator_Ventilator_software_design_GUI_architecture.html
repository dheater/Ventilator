<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RespiraWorks Ventilator: User Interface (UI) Controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RespiraWorks Ventilator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">User Interface (UI) <a class="el" href="classController.html">Controller</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The UI controller runs on a Raspberry Pi with a touchscreen and is written in C++17 using QT as the user interface framework. The reasoning behind this technology choice is described above, in the "Software
Design" section. Below we discuss the GUI features and architecture in more detail.</p>
<p>There is a page on <a class="el" href="md__home_runner_work_Ventilator_Ventilator_software_design_UI_requirements.html">User interface requirements</a>.</p>
<h2><a class="anchor" id="autotoc_md373"></a>
Features</h2>
<p>The most important features of the UI are displaying data and adjusting ventilation parameters.</p>
<ul>
<li>Data Display: The UI controller presents the user with the data coming from the ventilator, including both the actual sensor data and values that are derived from it (e.g. tidal volume and PIP/PEEP of the most recent breath). The data presented includes the standard respiratory cycle plot that most doctors and technicians would expect.</li>
<li>User Mode / Parameter Setting and Adjustment: The UI controller allows the user to set the desired ventilator mode and the desired control settings for that mode. The two modes currently supported are <a class="el" href="classPressure.html">Pressure</a> Control and <a class="el" href="classPressure.html">Pressure</a> Assist, as they are the modes supported by the Cycle <a class="el" href="classController.html">Controller</a>. The settings and ventilation mode can be changed at any time during operation, and adjusting a setting requires confirmation.</li>
<li>System state display: The UI controller displays a power source / battery status indicator and current time. Currently the battery status indicator uses a hard-coded value because the physical design lacks sensors to provide that data.</li>
</ul>
<p>The UI implements an alarm subsystem based on ISO-60601-1-8.</p>
<ul>
<li>Alarm State Detection: The UI controller is responsible for alarming when off-nominal events occur that require a clinician’s attention. The currently implemented alarms include over/under pressure (PIP is overshot or undershot by a certain amount compared to the commanded value) and disconnection of the patient circuit. The alarm architecture is robust and extensible, allowing us to easily add other alarms in the future.</li>
<li>Alarm Alerting and Information Display: The UI controller alerts the user to alarms through visual and audio cues:</li>
<li>Whenever an alarm condition is active, relevant sections in the UI are highlighted with color corresponding to the alarm priority. For example, over/under pressure alarms highlight the pressure graph.</li>
<li>If an alarm condition has been triggered, the UI emits an audio signal compliant with ISO 60601-1-8 according to the alarm priority until the alarm is acknowledged. If there are multiple unacknowledged alarms, the audio is based on the highest-priority one.</li>
<li>In ISO terminology, the audio signal is "latching": it persists even if the alarm condition is no longer active, so that the operator is made aware of a prior hazardous condition even if the condition activates sporadically and disappears before the operator walks up to the device upon hearing the audio signal.</li>
<li>Alarm Lifecycle: Whenever there are any unacknowledged alarms, the UI displays a banner showing the highest-priority currently unacknowledged alarm and offering to pause this alarm’s audio signal for 2 minutes.</li>
<li>Silenced alarms: The UI has a widget displaying the number of currently active but silenced (acknowledged) alarms, the highest priority of the alarms, and a countdown until the highest-priority alarm is unpaused.</li>
</ul>
<h2><a class="anchor" id="autotoc_md374"></a>
Software architecture</h2>
<p>The GUI follows a standard layered Model-View Architecture depicted in the following diagram.</p>
<p><img src="images/GUI_architecture.png" alt="" class="inline"/></p>
<p>Architecture of the RespiraWorks GUI</p>
<p>The GUI talks to the Cycle <a class="el" href="classController.html">Controller</a> over the serial bus, sending commanded values of ventilation mode and ventilation parameters, and receiving current sensor readings as well as a "breath id" value that is used to establish breath boundaries for computing per-breath signals.</p>
<p>The state of the GUI is encapsulated in a State Container object, which contains current parameter values to be commanded, recent history of sensor readings for displaying time series graphs, as well as objects that manage calculation of per-breath signals, detection of alarm conditions and management of alarm lifecycle.</p>
<p>The presentation layer is written in QML (the markup language used by the QT framework), where properties of various visual and audio elements are wired together with aspects of the State Container, including bidirectional updates.</p>
<p>Breath signals and the alarm subsystem deserve further discussion.</p>
<h3><a class="anchor" id="autotoc_md375"></a>
Breath signals</h3>
<p>As noted above, each set of sensor readings obtained from the Cycle <a class="el" href="classController.html">Controller</a> includes a "breath id" value, which changes on breath boundaries. Breath boundaries are mandated or detected by the Cycle <a class="el" href="classController.html">Controller</a>. This value can be used to partition the stream of sensor readings into intervals corresponding to a single breath, letting us compute per-breath signals.</p>
<p>We currently compute the following per-breath signals:</p>
<ul>
<li>Measured PIP and PEEP are respectively the maximum and minimum patient pressure observed during the most recent breath.</li>
<li>Measured RR (in modes where RR is not mandated, i.e. in <a class="el" href="classPressure.html">Pressure</a> Assist mode) is the inverse average time-per-breath over the several most recent breaths.</li>
</ul>
<p>These signals are naturally updated once per breath and are used both for displaying respective readings in the Presentation layer and for alarms.</p>
<h3><a class="anchor" id="autotoc_md376"></a>
Alarm subsystem</h3>
<p>There is also a proposed architecture for the <a class="el" href="md__home_runner_work_Ventilator_Ventilator_software_design_GUI_alarm_subsystem.html">GUI alarm subsystem</a>.</p>
<p>The UI controller is responsible for calculating and signaling all alarms, with the exception of a planned "UI controller not responding" alarm. The decision to place alarms into the UI controller, as opposed to the Cycle controller, was intended to minimize the amount of code in the cycle controller, the more safety-critical component of the system.</p>
<p>The alarm subsystem is based on ISO-60601-1-8 "General requirements, tests and guidance for alarm systems in medical electrical equipment and medical electrical systems". The key concepts are alarm conditions &ndash; potentially hazardous conditions requiring operator awareness or action &ndash; which can have different priority, and audio and visual alarm signals.</p>
<p>The subsystem consists of several independent alarms (one alarm for each condition) and an alarm manager that aggregates their signals, for example determining which audio signal should sound when several alarms are active.</p>
<p>Each alarm is notified on each new sensor reading (together with updated per-breath signals) in order to update the state of its condition. Each alarm can be queried by the Presentation layer for the current state of its visual and audio signals.</p>
<p>The visual signal is non-latching and is active whenever the alarm condition is currently active. It is wired up at the Presentation layer to the related visual elements, e.g., the over/under pressure alarms affect the color of the pressure graph.</p>
<p>The audio signal is latching and remains active when the alarm condition was active in the past but was not yet acknowledged. Audio signals of active alarms are aggregated by the Alarm manager in order to emit only the highest-priority one.</p>
<p>The presentation layer provides a control to acknowledge the current highest-priority active alarm, which silences the alarm’s audio signal for up to 2 minutes or until its condition becomes inactive. It also provides a control notifying the user of the existence of active alarms that have been silenced, with a countdown until the end of silencing.</p>
<h2><a class="anchor" id="autotoc_md377"></a>
User experience principles</h2>
<p>The user experience and the design of the user interface follows mandatory ISO norms for medical equipment, specifically lung ventilators. These norms include, but are not limited to:</p>
<ul>
<li>BS EN ISO 80601-2-12:2020 Medical electrical equipment</li>
<li>BS EN 62366-1:2015 Medical devices</li>
<li>BS ISO 19223:2019 Lung ventilators and related equipment - Vocabulary and semantics</li>
</ul>
<p>The user interface was designed using these ISO norms as guidelines, focusing on patient safety, with the following set of user experience principles in mind:</p>
<h3><a class="anchor" id="autotoc_md378"></a>
Use safety</h3>
<p>The GUI and user experience must be designed with error prevention front and center, because every mistake made by an operator in a stressful and life-threatening situation can have severe consequences for the patient.</p>
<p>Example: any parameter that can be changed by the operator and that has direct impact on the ventilator performance must be confirmed before being executed.</p>
<h3><a class="anchor" id="autotoc_md379"></a>
System usability</h3>
<p>The GUI’s design must present an effective, efficient, and easy-to-use solution that lets the operator complete their tasks in a successful, confident and satisfying manner.</p>
<p>Example: the main screen serves as the hub of the application, from which every functionality can be easily accessed and performed in a linear fashion, ultimately leading back to the hub. This design prevents the operator from getting lost within the application.</p>
<h3><a class="anchor" id="autotoc_md380"></a>
Workload</h3>
<p>For every task available, the GUI must provide a solution that keeps the operator’s mental demand, physical demand, temporal demand, effort and frustration as low as possible.</p>
<p>Example: alarms can be silenced for a brief period of time to let the operator better focus on the patient’s need.</p>
<h3><a class="anchor" id="autotoc_md381"></a>
Visibility</h3>
<p>Critical information displayed in the user interface (i.e. values, waveforms, alarm signals) must be perceivable at 4m distance and perfectly legible at 1m.</p>
<p>Example: the high contrast of screen elements vs background color, the font size and selected alarm colors support this requirement.</p>
<h3><a class="anchor" id="autotoc_md382"></a>
Touch Target Sizing</h3>
<p>Interactive affordances such as buttons must meet the minimal recommended touch target size of 1 x 1 cm to guarantee a large enough surface for the operator to press. Touch target dimensions should also be adapted to meet the needs of various situations.</p>
<p>Example: primary functions used in critical situations should have a larger touch target than a secondary function.</p>
<h3><a class="anchor" id="autotoc_md383"></a>
Fitt’s law</h3>
<p>The user experience must follow <a href="https://www.interaction-design.org/literature/topics/fitts-law">Fitt’s law</a> in determining the position and dimension of interactive elements on the UI, to ensure operators can perform primary tasks quickly.</p>
<p>Example:</p>
<h3><a class="anchor" id="autotoc_md384"></a>
Hick’s law</h3>
<p>The user experience must follow <a href="https://www.interaction-design.org/literature/article/hick-s-law-making-the-choice-easier-for-users">Hick’s law</a> in structuring content, information architecture, and user flows, to ensure operators always have a clear path forward when performing a task.</p>
<p>Example: touch targets to change or set parameters should be larger than the touch target for the menu in the top left corner, as accessing the menu is a secondary operation compared to changing values to directly support the patient.</p>
<h3><a class="anchor" id="autotoc_md385"></a>
Accessibility</h3>
<p>The design must take into account accessibility guidelines that let operators with disabilities use the system without constraints or risks to the patient’s health.</p>
<p>Example: color values for alarm priorities were selected and tested to accommodate the most common types of color blindness (deuteranopia, protanopia, achromatopsia, etc.). Additionally, different alarm priorities emit different sounds communicating their degree of urgency per ISO-60601-1-8. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
